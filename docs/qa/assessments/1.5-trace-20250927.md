# Requirements Traceability Matrix

## Story: 1.5 - Primary Revenue Dashboard (Three-Section Chart)

### Coverage Summary

- Total Requirements: 8
- Fully Covered: 3 (37.5%)
- Partially Covered: 4 (50%)
- Not Covered: 1 (12.5%)

### Requirement Mappings

#### AC1: "Raised" section with total revenue amount and donation count display matching FundraisUP styling

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `sections/__tests__/TotalRaisedSection.test.tsx::shows metrics and chart area`
  - Given: TotalRaisedSection component with mock data
  - When: Component renders with daily granularity
  - Then: Total Revenue and Donations labels are displayed

- **API Test**: `api/analytics/total-raised/__tests__/route.test.ts::returns current period data`
  - Given: Valid date range and granularity parameters
  - When: API endpoint called for total raised data
  - Then: Returns totalAmount and donationCount with trend data

#### AC2: "First Installments" section showing new recurring donor revenue with count metrics

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `sections/__tests__/FirstInstallmentsSection.test.tsx`
  - Given: FirstInstallmentsSection component
  - When: Component renders with granularity setting
  - Then: First installments metrics and chart displayed

- **API Test**: `api/analytics/first-installments/__tests__/route.test.ts`
  - Given: Query parameters for first installments (freq=1, no underscore in order_id)
  - When: First installments endpoint called
  - Then: Returns filtered recurring donor revenue data

#### AC3: "One-time donations" section displaying single gift revenue and transaction count

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `sections/__tests__/OneTimeDonationsSection.test.tsx`
  - Given: OneTimeDonationsSection component
  - When: Component renders with granularity
  - Then: One-time donation metrics and visualization shown

- **API Test**: `api/analytics/one-time-donations/__tests__/route.test.ts`
  - Given: Query parameters for one-time donations (freq=0)
  - When: One-time donations endpoint called
  - Then: Returns single gift revenue and count data

#### AC4: Three synchronized Recharts area charts with blue gradient fills matching reference design

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Integration Test**: `__tests__/PrimaryRevenueDashboard.test.tsx::renders three sections`
  - Given: Primary dashboard with three sections
  - When: Dashboard renders with FilterProvider
  - Then: All three section titles are present

**Gap**: No specific test for chart synchronization, gradient fills, or visual consistency

#### AC5: Shared date filtering and comparison overlay functionality across all three sections

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **API Test**: `total-raised/__tests__/route.test.ts::supports comparison period`
  - Given: Date range with comparison period parameters
  - When: API called with comparison dates
  - Then: Returns both current and comparison period data

**Gap**: No integration test verifying filter changes affect all three sections simultaneously

#### AC6: Daily/Weekly view toggle affecting all three charts simultaneously

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Component Test**: `__tests__/PrimaryRevenueDashboard.test.tsx::renders view toggle`
  - Given: Primary dashboard component
  - When: Component renders
  - Then: Daily and Weekly toggle buttons are present

**Gap**: No test verifying toggle changes affect all sections' granularity

#### AC7: Responsive layout maintaining three-section structure on different screen sizes

**Coverage: NONE**

**Gap**: No responsive layout tests implemented

#### AC8: Real-time data updates reflecting current filter selections

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Hook Logic**: `useAnalytics.ts` implements debounced updates (150ms)
  - Given: Filter parameters change in store
  - When: useAnalytics hook detects parameter changes
  - Then: Debounced API call fetches updated data

**Gap**: No integration test verifying real-time updates across sections

### Critical Gaps

1. **Visual Chart Consistency (AC4)**
   - Gap: No tests for Recharts gradient fills or chart synchronization
   - Risk: High - Visual inconsistencies could impact user experience
   - Action: Add visual regression tests or chart configuration tests

2. **Responsive Layout Testing (AC7)**
   - Gap: No responsive layout tests across screen sizes
   - Risk: Medium - Layout could break on mobile/tablet devices
   - Action: Add responsive testing with different viewport sizes

3. **Real-time Integration (AC8)**
   - Gap: No end-to-end test for filter changes affecting all sections
   - Risk: Medium - Sections might not update consistently
   - Action: Add integration test for coordinated section updates

### Test Design Recommendations

Based on gaps identified, recommend:

1. **Visual Consistency Tests**
   - Add chart configuration validation tests
   - Verify gradient definitions and color consistency
   - Test chart height and responsive behavior

2. **Integration Tests**
   - Filter change propagation across all three sections
   - View toggle affecting chart granularity simultaneously
   - Comparison overlay consistency

3. **Responsive Tests**
   - Mobile layout (single column)
   - Desktop layout (three columns)
   - Tablet breakpoint behavior

4. **Performance Tests**
   - Verify sub-3-second load time requirement
   - Test with large date ranges
   - Concurrent section loading behavior

### Risk Assessment

- **High Risk**: AC7 (Responsive layout) - No coverage
- **Medium Risk**: AC4, AC5, AC6, AC8 - Partial coverage missing integration aspects
- **Low Risk**: AC1, AC2, AC3 - Full unit and API test coverage